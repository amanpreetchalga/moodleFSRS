<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="mod/fsrs/db" VERSION="2025010100" COMMENT="FSRS plugin schema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <TABLES>

        <TABLE NAME="fsrs" COMMENT="FSRS activity instances">
            <FIELDS>
                <FIELD NAME="id"              TYPE="int"    LENGTH="10" NOTNULL="true"  SEQUENCE="true"  COMMENT="Primary key" />
                <FIELD NAME="course"          TYPE="int"    LENGTH="10" NOTNULL="true"  SEQUENCE="false" COMMENT="Moodle course id" />
                <FIELD NAME="name"            TYPE="char"   LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Instance name" />
                <FIELD NAME="intro"           TYPE="text"   LENGTH="big" NOTNULL="false" SEQUENCE="false" COMMENT="Introduction" />
                <FIELD NAME="introformat"     TYPE="int"    LENGTH="2"  NOTNULL="true"  DEFAULT="0" SEQUENCE="false" COMMENT="Intro format" />
                <FIELD NAME="desiredretention" TYPE="number" LENGTH="10" DECIMALS="2" NOTNULL="true" DEFAULT="0.90" SEQUENCE="false" COMMENT="Target retention" />
                <FIELD NAME="newperday"       TYPE="int"    LENGTH="10" NOTNULL="true"  DEFAULT="20"  SEQUENCE="false" COMMENT="New cards per day" />
                <FIELD NAME="reviewcap"       TYPE="int"    LENGTH="10" NOTNULL="true"  DEFAULT="200" SEQUENCE="false" COMMENT="Max reviews per day" />
                <FIELD NAME="timezone"        TYPE="char"   LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Deck timezone (optional)" />
                <FIELD NAME="timecreated"     TYPE="int"    LENGTH="10" NOTNULL="true"  DEFAULT="0" SEQUENCE="false" COMMENT="Creation time" />
                <FIELD NAME="timemodified"    TYPE="int"    LENGTH="10" NOTNULL="true"  DEFAULT="0" SEQUENCE="false" COMMENT="Last modified time" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
            </KEYS>
            <INDEXES>
                <INDEX NAME="course_idx" UNIQUE="false" FIELDS="course" />
            </INDEXES>
        </TABLE>

        <TABLE NAME="fsrs_topic" COMMENT="Topics inside an FSRS deck">
            <FIELDS>
                <FIELD NAME="id"           TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="true"  COMMENT="Primary key" />
                <FIELD NAME="fsrsid"       TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FSRS instance id" />
                <FIELD NAME="name"         TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Topic name" />
                <FIELD NAME="description"  TYPE="text" LENGTH="big" NOTNULL="false" SEQUENCE="false" COMMENT="Topic description" />
                <FIELD NAME="sortorder"    TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Ordering within deck" />
                <FIELD NAME="timecreated"  TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Creation time" />
                <FIELD NAME="timemodified" TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Last modified time" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="fsrsid_fk" TYPE="foreign" FIELDS="fsrsid" REFTABLE="fsrs" REFFIELDS="id" />
            </KEYS>
            <INDEXES>
                <INDEX NAME="fsrsid_idx" UNIQUE="false" FIELDS="fsrsid" />
            </INDEXES>
        </TABLE>

        <TABLE NAME="fsrs_flashcard" COMMENT="Flashcards belonging to an FSRS deck">
            <FIELDS>
                <FIELD NAME="id"           TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="true"  COMMENT="Primary key" />
                <FIELD NAME="fsrsid"       TYPE="int"  LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FSRS instance id" />
                <FIELD NAME="topicid"      TYPE="int"  LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Topic id" />
                <FIELD NAME="front"        TYPE="text" LENGTH="big" NOTNULL="true"  SEQUENCE="false" COMMENT="Question / front" />
                <FIELD NAME="back"         TYPE="text" LENGTH="big" NOTNULL="true"  SEQUENCE="false" COMMENT="Answer / back" />
                <FIELD NAME="optionsjson"  TYPE="text" LENGTH="big" NOTNULL="false" SEQUENCE="false" COMMENT="JSON options for MCQ" />
                <FIELD NAME="questiontype" TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="0=open,1=MCQ,2=cloze" />
                <FIELD NAME="availablefrom" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Available from time" />
                <FIELD NAME="availableuntil" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Available until time" />
                <FIELD NAME="isunlocked"   TYPE="int"  LENGTH="2"  NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Manual toggle" />
                <FIELD NAME="tags"         TYPE="text" LENGTH="big" NOTNULL="false" SEQUENCE="false" COMMENT="Tags" />
                <FIELD NAME="createdby"    TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Creator userid" />
                <FIELD NAME="sortorder"    TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Ordering within topic" />
                <FIELD NAME="timecreated"  TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Creation time" />
                <FIELD NAME="timemodified" TYPE="int"  LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Last modified time" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="fsrsid_fk" TYPE="foreign" FIELDS="fsrsid" REFTABLE="fsrs" REFFIELDS="id" />
                <KEY NAME="topicid_fk" TYPE="foreign" FIELDS="topicid" REFTABLE="fsrs_topic" REFFIELDS="id" />
            </KEYS>
            <INDEXES>
                <INDEX NAME="fsrsid_idx" UNIQUE="false" FIELDS="fsrsid" />
                <INDEX NAME="topicid_idx" UNIQUE="false" FIELDS="topicid" />
            </INDEXES>
        </TABLE>

        <TABLE NAME="fsrs_user_card" COMMENT="Per-user FSRS state for each flashcard">
            <FIELDS>
                <FIELD NAME="id"             TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="true"  COMMENT="Primary key" />
                <FIELD NAME="userid"         TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User id" />
                <FIELD NAME="flashcardid"    TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Flashcard id" />
                <FIELD NAME="state"          TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="New/learning/review" />
                <FIELD NAME="is_starred"     TYPE="int"    LENGTH="2"  NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Starred by user" />
                <FIELD NAME="is_suspended"   TYPE="int"    LENGTH="2"  NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Suspended card" />
                <FIELD NAME="stability"      TYPE="number" LENGTH="10" DECIMALS="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="FSRS stability" />
                <FIELD NAME="difficulty"     TYPE="number" LENGTH="10" DECIMALS="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="FSRS difficulty" />
                <FIELD NAME="due_at"         TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Next due timestamp" />
                <FIELD NAME="interval_days"  TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Current interval in days" />
                <FIELD NAME="reps"           TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Total reviews" />
                <FIELD NAME="lapses"         TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Times forgotten" />
                <FIELD NAME="last_rating"    TYPE="int"    LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Last rating 0–3" />
                <FIELD NAME="last_reviewed_at" TYPE="int"  LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Last review time" />
                <FIELD NAME="correct_count"  TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of correct answers" />
                <FIELD NAME="wrong_count"    TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of wrong answers" />
                <FIELD NAME="timecreated"    TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Creation time" />
                <FIELD NAME="timemodified"   TYPE="int"    LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Last modified time" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="userid_fk" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id" />
                <KEY NAME="flashcardid_fk" TYPE="foreign" FIELDS="flashcardid" REFTABLE="fsrs_flashcard" REFFIELDS="id" />
            </KEYS>
            <INDEXES>
                <INDEX NAME="user_flashcard_uix" UNIQUE="true"  FIELDS="userid, flashcardid" />
                <INDEX NAME="userid_due_idx"     UNIQUE="false" FIELDS="userid, due_at" />
            </INDEXES>
        </TABLE>

        <TABLE NAME="fsrs_review_log" COMMENT="History of FSRS reviews">
            <FIELDS>
                <FIELD NAME="id"               TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="true"  COMMENT="Primary key" />
                <FIELD NAME="userid"           TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User id" />
                <FIELD NAME="flashcardid"      TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Flashcard id" />
                <FIELD NAME="usercardid"       TYPE="int"    LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User-card id" />
                <FIELD NAME="rating"           TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="0–3 Again/Hard/Good/Easy" />
                <FIELD NAME="was_correct"      TYPE="int"    LENGTH="2"  NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Objectively correct" />
                <FIELD NAME="response_ms"      TYPE="int"    LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Time to answer (ms)" />
                <FIELD NAME="stability_before" TYPE="number" LENGTH="10" DECIMALS="4" NOTNULL="false" SEQUENCE="false" COMMENT="Stability before review" />
                <FIELD NAME="stability_after"  TYPE="number" LENGTH="10" DECIMALS="4" NOTNULL="false" SEQUENCE="false" COMMENT="Stability after review" />
                <FIELD NAME="interval_before"  TYPE="int"    LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Interval before review" />
                <FIELD NAME="interval_after"   TYPE="int"    LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Interval after review" />
                <FIELD NAME="reviewed_at"      TYPE="int"    LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Review timestamp" />
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id" />
                <KEY NAME="userid_fk" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id" />
                <KEY NAME="flashcardid_fk" TYPE="foreign" FIELDS="flashcardid" REFTABLE="fsrs_flashcard" REFFIELDS="id" />
                <KEY NAME="usercardid_fk" TYPE="foreign" FIELDS="usercardid" REFTABLE="fsrs_user_card" REFFIELDS="id" />
            </KEYS>
            <INDEXES>
                <INDEX NAME="userid_idx"      UNIQUE="false" FIELDS="userid" />
                <INDEX NAME="flashcardid_idx" UNIQUE="false" FIELDS="flashcardid" />
                <INDEX NAME="reviewed_at_idx" UNIQUE="false" FIELDS="reviewed_at" />
            </INDEXES>
        </TABLE>

    </TABLES>
</XMLDB>
